---
id: g9c1g8q5
title: Prometheus IAM Role
file_version: 1.1.2
app_version: 1.11.3
---

`ðŸ“„ iam.tf`

## Prometheus IAM Role Behavior<br/>

*   This is a default IAM role if a role is not referenced when the module is called (still needs some testing)

<br/>


<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### ðŸ“„ iam.tf
```tf
1      resource "aws_iam_role" "prometheus_role" {
2        name               = "${var.environment}-${var.name_prefix}-role"
3        assume_role_policy = <<EOF
4      {
5        "Version": "2012-10-17",
6        "Statement": [
7          {
8            "Action": "sts:AssumeRole",
9            "Principal": {
10             "Service": "ecs:*"
11           },
12           "Effect": "Allow",
13           "Sid": ""
14         }
15       ]
16     }
17     EOF
18     }
19     
20     resource "aws_iam_policy" "prom_read_write_policy" {
21       name        = "${var.environment}-${var.name_prefix}-ecs-prom-policy"
22       path        = "/"
23       description = "Policy to allow ecs discovery of prometheus metrics and writes to AMP"
24     
25       policy = templatefile("${path.module}/policies/prometheus-amp.json", {
26         account_id       = data.aws_caller_identity.current.account_id
27         region           = var.region
28         cluster_name     = var.cluster_name
29         s3_bucket        = var.s3_bucket
30         AMP_resource_arn = var.AMP_resource_arn
31       })
32     }
33     
34     resource "aws_iam_role_policy_attachment" "ecs_prom_policy_attachment" {
35       policy_arn = aws_iam_policy.prom_read_write_policy.arn
36       role       = aws_iam_role.prometheus_role.arn
37     }
```

<br/>

The Terraform for `aws_ecs_task_definition prometheus-fargate` uses conditionals to determine which execution and task role to use for the task.

<br/>


<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### ðŸ“„ prometheus-td.tf
```tf
3        execution_role_arn       = var.prom_execution_role_arn == "" ? aws_iam_role.prometheus_role.arn : var.prom_execution_role_arn
4        task_role_arn            = var.prom_task_role_arn == "" ? aws_iam_role.prometheus_role.arn : var.prom_task_role_arn
```

<br/>

This file was generated by Swimm. [Click here to view it in the app](https://app.swimm.io/repos/Z2l0aHViJTNBJTNBVGVycmFmb3JtLVByb21ldGhldXMtZWNzLWRpc2NvdmVyeS1mYXJnYXRlJTNBJTNBbWVkaWF2aW5l/docs/g9c1g8q5).
